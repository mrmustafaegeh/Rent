generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String
  role          Role      @default(CUSTOMER)
  image         String?
  phone         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  companyId     String?
  bookings      Booking[] @relation("CustomerBookings")
  staffBookings Booking[] @relation("StaffBookings")
  messages      Message[]
  reviews       Review[]
  company       Company?  @relation(fields: [companyId], references: [id])
  vehicles      Vehicle[]
  wishlist      Wishlist?
}

model Message {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  content   String
  status    String   @default("unread")
  createdAt DateTime @default(now())
  userId    String?
  user      User?    @relation(fields: [userId], references: [id])
}

model Wishlist {
  id        String    @id @default(cuid())
  userId    String    @unique
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  user      User      @relation(fields: [userId], references: [id])
  vehicles  Vehicle[] @relation("VehicleToWishlist")
}

model Company {
  id          String    @id @default(cuid())
  name        String
  email       String?
  phone       String?
  address     String?
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  bookings    Booking[]
  users       User[]
  vehicles    Vehicle[]
}

model Vehicle {
  id             String          @id @default(cuid())
  brand          String
  vehicleModel   String
  year           Int
  category       VehicleCategory
  type           String          @default("rent")
  transmission   String          @default("Automatic")
  fuelType       String          @default("Petrol")
  seats          Int             @default(4)
  dailyPrice     Float
  weeklyPrice    Float?
  monthlyPrice   Float?
  salePrice      Float?
  currency       String          @default("EUR")
  isFeatured     Boolean         @default(false)
  location       String          @default("Kyrenia")
  available      Boolean         @default(true)
  quantity       Int             @default(1)
  status         VehicleStatus   @default(PENDING)
  features       String[]
  mileage        Int?
  condition      String?
  origin         String          @default("GCC")
  insurance      Boolean         @default(true)
  minRentalDays  Int             @default(1)
  dailyMileage   Int             @default(250)
  monthlyMileage Int             @default(4500)
  doors          Int?            @default(4)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  ownerId        String?
  companyId      String?
  bookings       Booking[]
  reviews        Review[]
  company        Company?        @relation(fields: [companyId], references: [id])
  owner          User?           @relation(fields: [ownerId], references: [id])
  images         VehicleImage[]
  wishlists      Wishlist[]      @relation("VehicleToWishlist")
}

model VehicleImage {
  id        String  @id @default(cuid())
  url       String
  isPrimary Boolean @default(false)
  vehicleId String
  vehicle   Vehicle @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
}

model Booking {
  id              String        @id @default(cuid())
  bookingNumber   String        @unique
  startDate       DateTime
  endDate         DateTime
  totalPrice      Float
  status          BookingStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  pickupLocation  String
  dropoffLocation String
  driversLicense  String?
  passport        String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  customerId      String
  vehicleId       String
  companyId       String?
  staffId         String?
  company         Company?      @relation(fields: [companyId], references: [id])
  customer        User          @relation("CustomerBookings", fields: [customerId], references: [id])
  assignedStaff   User?         @relation("StaffBookings", fields: [staffId], references: [id])
  vehicle         Vehicle       @relation(fields: [vehicleId], references: [id])
  notes           BookingNote[]
  reviews         Review[]
}

model BookingNote {
  id        String   @id @default(cuid())
  text      String
  createdAt DateTime @default(now())
  bookingId String
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
}

model Review {
  id         String   @id @default(cuid())
  rating     Int
  comment    String
  isApproved Boolean  @default(false)
  createdAt  DateTime @default(now())
  userId     String
  vehicleId  String
  bookingId  String?
  booking    Booking? @relation(fields: [bookingId], references: [id])
  user       User     @relation(fields: [userId], references: [id])
  vehicle    Vehicle  @relation(fields: [vehicleId], references: [id])

  @@unique([userId, vehicleId])
}

model Location {
  id             String   @id @default(cuid())
  name           String
  address        String
  city           String
  lat            Float
  lng            Float
  phone          String
  email          String
  operatingHours String   @default("9:00 AM - 9:00 PM")
  image          String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

enum Role {
  ADMIN
  PARTNER
  STAFF
  CUSTOMER
}

enum VehicleStatus {
  PENDING
  APPROVED
  REJECTED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  PENDING_PAYMENT
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
  PAY_AT_PICKUP
}

enum VehicleCategory {
  LUXURY
  SPORTS
  SUV
  SEDAN
  ECONOMY
  VAN
  ELECTRIC
  CONVERTIBLE
  HATCHBACK
}
