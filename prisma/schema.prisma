// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  ADMIN
  PARTNER
  STAFF
  CUSTOMER
}

enum VehicleStatus {
  PENDING
  APPROVED
  REJECTED
}

enum BookingStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  PENDING_PAYMENT
}

enum PaymentStatus {
  PENDING
  PAID
  REFUNDED
  FAILED
  PAY_AT_PICKUP
}

enum VehicleCategory {
  LUXURY
  SPORTS
  SUV
  SEDAN
  ECONOMY
  VAN
  ELECTRIC
  CONVERTIBLE
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  password      String
  role          Role      @default(CUSTOMER)
  image         String?
  phone         String?
  isActive      Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  // Relationships
  bookings      Booking[] @relation("CustomerBookings")
  staffBookings Booking[] @relation("StaffBookings")
  vehicles      Vehicle[] // Vehicles owned by partners
  company       Company?  @relation(fields: [companyId], references: [id])
  companyId     String?

  reviews       Review[]
  wishlist      Wishlist?
  messages      Message[]
}

model Message {
  id        String   @id @default(cuid())
  name      String
  email     String
  phone     String?
  content   String
  status    String   @default("unread")
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
  userId    String?
}

model Wishlist {
  id        String    @id @default(cuid())
  user      User      @relation(fields: [userId], references: [id])
  userId    String    @unique
  vehicles  Vehicle[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

model Company {
  id          String    @id @default(cuid())
  name        String
  email       String?
  phone       String?
  address     String?
  description String?
  isActive    Boolean   @default(true)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relationships
  users       User[]
  vehicles    Vehicle[]
  bookings    Booking[]
}

model Vehicle {
  id              String          @id @default(cuid())
  brand           String
  vehicleModel    String
  year            Int
  category        VehicleCategory
  type            String          @default("rent")
  transmission    String          @default("Automatic")
  fuelType        String          @default("Petrol")
  seats           Int             @default(4)
  dailyPrice      Float
  weeklyPrice     Float?
  monthlyPrice    Float?
  salePrice       Float?
  currency        String          @default("EUR")
  isFeatured      Boolean         @default(false)
  location        String          @default("Kyrenia")
  available       Boolean         @default(true)
  quantity        Int             @default(1)
  status          VehicleStatus   @default(PENDING)
  features        String[]
  images          VehicleImage[]
  
  // Specs
  mileage         Int?            // Total mileage (for sales)
  condition       String?         // (for sales)
  origin          String          @default("GCC")
  insurance       Boolean         @default(true)
  minRentalDays   Int             @default(1)
  dailyMileage    Int             @default(250)
  monthlyMileage  Int             @default(4500)
  doors           Int?            @default(4)
  
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  // Relationships
  owner           User?           @relation(fields: [ownerId], references: [id])
  ownerId         String?
  company         Company?        @relation(fields: [companyId], references: [id])
  companyId       String?
  bookings        Booking[]
  reviews         Review[]
  wishlists       Wishlist[]
}

model VehicleImage {
  id        String   @id @default(cuid())
  url       String
  isPrimary Boolean  @default(false)
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id], onDelete: Cascade)
  vehicleId String
}

model Booking {
  id              String        @id @default(cuid())
  bookingNumber   String        @unique
  startDate       DateTime
  endDate         DateTime
  totalPrice      Float
  status          BookingStatus @default(PENDING)
  paymentStatus   PaymentStatus @default(PENDING)
  paymentMethod   String?
  pickupLocation  String
  dropoffLocation String
  driversLicense  String?
  passport        String?
  
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  // Relationships
  customer        User          @relation("CustomerBookings", fields: [customerId], references: [id])
  customerId      String
  vehicle         Vehicle       @relation(fields: [vehicleId], references: [id])
  vehicleId       String
  company         Company?      @relation(fields: [companyId], references: [id])
  companyId       String?
  assignedStaff   User?         @relation("StaffBookings", fields: [staffId], references: [id])
  staffId         String?
  notes           BookingNote[]
  reviews         Review[]
}

model BookingNote {
  id        String   @id @default(cuid())
  text      String
  createdAt DateTime @default(now())
  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  bookingId String
}

model Review {
  id        String   @id @default(cuid())
  rating    Int
  comment   String
  isApproved Boolean  @default(false)
  createdAt DateTime @default(now())
  
  // Relationships
  user      User     @relation(fields: [userId], references: [id])
  userId    String
  vehicle   Vehicle  @relation(fields: [vehicleId], references: [id])
  vehicleId String
  booking   Booking? @relation(fields: [bookingId], references: [id])
  bookingId String?

  @@unique([userId, vehicleId])
}

model Location {
  id             String   @id @default(cuid())
  name           String
  address        String
  city           String
  lat            Float
  lng            Float
  phone          String
  email          String
  operatingHours String   @default("9:00 AM - 9:00 PM")
  image          String?
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}
